<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Daily Points Tracker</title>

  <!-- Tailwind + Chart.js -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>

  <link rel="manifest" href="manifest.webmanifest" />
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen flex flex-col">
  <!-- Header -->
  <header class="p-4 bg-gray-800 shadow flex items-center justify-between">
    <div class="text-lg font-bold">Score du jourÂ : <span id="dailyScore" class="text-emerald-400">0</span></div>
    <div class="flex items-center gap-2">
      <span id="todayLabel" class="text-sm text-gray-400"></span>
      <button id="resetBtn" class="px-3 py-1 rounded-lg bg-red-600 text-xs hover:bg-red-500">ResetÂ ðŸ”„</button>
    </div>
  </header>

  <!-- Tabs -->
  <nav class="flex justify-center gap-4 my-3">
    <button id="tabTasks" class="px-4 py-2 rounded-lg bg-emerald-600 font-semibold">TÃ¢ches</button>
    <button id="tabStats" class="px-4 py-2 rounded-lg bg-gray-700 font-semibold">Statistiques</button>
  </nav>

  <main id="mainContent" class="flex-1 overflow-y-auto p-4"></main>
  <footer class="text-center text-xs text-gray-500 py-2">Â©â€¯2025Â â€“ LibertÃ©Â !</footer>

  <!-- Toast -->
  <div id="toast" class="hidden fixed bottom-4 inset-x-0 flex justify-center pointer-events-none">
    <span id="toastMsg" class="px-4 py-2 rounded-lg bg-gray-800 text-sm shadow-lg opacity-0 transition-opacity duration-300"></span>
  </div>

<script>
/***** Firebase *****/
firebase.initializeApp({ apiKey:"AIzaSyCssm-z4wtOWcK1qvbJc2SIQ6Pvc3JEszY", authDomain:"health-fdf5b.firebaseapp.com", projectId:"health-fdf5b" });
const auth=firebase.auth(); const db=firebase.firestore();
let remoteDocRef;

/***** Helpers *****/
const LS_KEY='dpt-db';
const todayStr=()=>new Date().toISOString().slice(0,10);
const loadData=()=>JSON.parse(localStorage.getItem(LS_KEY)||'{}');
const saveData=d=>localStorage.setItem(LS_KEY,JSON.stringify(d));
const getDayTotal=d=>loadData()[d]||0;

/***** Toast *****/
function showToast(msg){
  const toast=document.getElementById('toast');
  const box=document.getElementById('toastMsg');
  box.textContent=msg;
  toast.classList.remove('hidden');
  requestAnimationFrame(()=>box.classList.remove('opacity-0'));
  setTimeout(()=>{ box.classList.add('opacity-0'); setTimeout(()=>toast.classList.add('hidden'),300); },1200);
}

/***** Flash bouton *****/
function flash(btn){
  btn.classList.remove('bg-gray-800');
  btn.classList.add('bg-emerald-700');
  setTimeout(()=>{ btn.classList.add('bg-gray-800'); btn.classList.remove('bg-emerald-700'); },200);
}

/***** Tasks *****/
const TASKS=[
  {id:1,name:"Boire un verre d'eau",pts:1},
  {id:2,name:"Ã‰tirements matinaux",pts:2},
  {id:3,name:"MÃ©ditationÂ 5Â min",pts:3},
  {id:4,name:"MarcheÂ 10Â min",pts:2},
  {id:5,name:"LectureÂ 10Â pages",pts:4}
];

/***** UI refs *****/
const scoreEl=document.getElementById('dailyScore');
const labelEl=document.getElementById('todayLabel');
const main=document.getElementById('mainContent');
const tabTasks=document.getElementById('tabTasks');
const tabStats=document.getElementById('tabStats');
const resetBtn=document.getElementById('resetBtn');
let chartInstance=null,currentTab='tasks',currentRange='7';

/***** Renderers (modif lÃ©gÃ¨re dans renderTasks) *****/
function setActive(tab){
  currentTab=tab;
  tabTasks.classList.toggle('bg-emerald-600',tab==='tasks'); tabTasks.classList.toggle('bg-gray-700',tab!=='tasks');
  tabStats.classList.toggle('bg-emerald-600',tab==='stats'); tabStats.classList.toggle('bg-gray-700',tab!=='stats');
}
function renderTasks(){
  setActive('tasks');
  const today=todayStr();
  scoreEl.textContent=getDayTotal(today);
  labelEl.textContent=new Date().toLocaleDateString('fr-FR',{weekday:'long',day:'numeric',month:'short'});
  main.innerHTML='';
  TASKS.forEach(t=>{
    const btn=document.createElement('button');
    btn.className='w-full mb-3 px-4 py-3 rounded-xl bg-gray-800 active:bg-emerald-700 transition-colors duration-500 shadow';
    btn.innerHTML=`${t.name}<span class='float-right font-semibold'>+${t.pts}</span>`;
    btn.onclick=()=>{
      addPoints(today,t.pts);
      scoreEl.textContent=getDayTotal(today);
      showToast(`+${t.pts}Â ptsÂ âœ…`);
      flash(btn);
    };
    main.appendChild(btn);
  });
}
function renderStats(){ /* inchangÃ© */ }
function renderRange(r){ /* inchangÃ© */ }

/***** Sync & Reset *****/
function addPoints(d,pts){ const dbData=loadData(); dbData[d]=(dbData[d]||0)+pts; saveData(dbData); remoteDocRef&&remoteDocRef.set(dbData).catch(console.error); }
function resetToday(){ const d=todayStr(); const dbData=loadData(); dbData[d]=0; saveData(dbData); remoteDocRef&&remoteDocRef.set(dbData).catch(console.error); scoreEl.textContent='0'; if(currentTab==='stats')renderRange(currentRange); showToast('Score remis Ã Â 0'); }
function startRealtimeSync(){ /* inchangÃ© */ }

/***** Init *****/
function initUI(){ tabTasks.onclick=renderTasks; tabStats.onclick=renderStats; resetBtn.onclick=resetToday; renderTasks(); }

auth.signInAnonymously().then(()=>{ remoteDocRef=db.collection('users').doc('global'); remoteDocRef.get().then(snap=>{ if(snap.exists) localStorage.setItem(LS_KEY,JSON.stringify(snap.data())); initUI(); startRealtimeSync(); }).catch(err=>{console.error(err); initUI();}); }).catch(console.error);

/***** PWA offline *****/
if('serviceWorker' in navigator){ navigator.serviceWorker.register('sw-v2.js').catch(console.error); }
</script>
</body>
</html>
